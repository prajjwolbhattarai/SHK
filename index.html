<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SHK Rhein-Neckar | Branchenmagazin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
      .loader {
        border: 3px solid #f3f3f3;
        border-radius: 50%;
        border-top: 3px solid #b45309;
        width: 24px;
        height: 24px;
        -webkit-animation: spin 1s linear infinite;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Montserrat', 'sans-serif'] },
            colors: { 'brand-dark': '#0f172a', 'brand-copper': '#b45309', 'brand-steel': '#475569', 'brand-surface': '#f8fafc' }
          }
        }
      }
    </script>
</head>
<body class="bg-brand-surface text-slate-900 antialiased selection:bg-brand-copper selection:text-white">

    <!-- Header -->
    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <a href="index.html" class="flex-shrink-0 flex items-center">
                    <img src="shklogo.jpg" alt="SHK Rhein-Neckar" class="h-12 w-auto object-contain" onerror="this.src='https://via.placeholder.com/150x50?text=SHK+Logo'"/>
                </a>
                <div class="hidden lg:flex space-x-8 items-center h-full">
                    <button onclick="router('home')" class="text-xs font-bold uppercase tracking-widest text-brand-steel hover:text-brand-dark transition">Magazin</button>
                    <button onclick="router('directory')" class="text-xs font-bold uppercase tracking-widest text-brand-steel hover:text-brand-dark transition">Verzeichnis</button>
                    <button onclick="router('page', 'page-submit')" class="text-xs font-bold uppercase tracking-widest text-brand-copper">Artikel Einreichen</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="app-content" class="min-h-screen">
        <!-- Content injected by JS -->
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 pt-16 pb-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-brand-steel mb-4">Das führende Branchenmagazin für die SHK-Profis in der Rhein-Neckar Region.</p>
            <div class="flex justify-center space-x-6 text-xs font-bold uppercase text-gray-400 mb-8">
                <a href="#" onclick="router('page', 'page-imprint')">Impressum</a>
                <a href="#" onclick="router('page', 'page-privacy')">Datenschutz</a>
                <a href="admin.html" class="text-brand-copper">Redaktion Login</a>
            </div>
            <p class="text-xs text-gray-300">© 2025 SHK Rhein-Neckar. Alle Rechte vorbehalten.</p>
        </div>
    </footer>

<script>
// --- CONFIGURATION ---
const API_URL = 'https://script.google.com/macros/s/AKfycbxw9Sw74S1Yy5W0zVCRHZ7ZxTTOISUKZzk793WkeR8TW9eF61Mws4aGcOPRg1JaiUBuPQ/exec';

// --- STATE ---
let articles = [];
let directory = [];
let isLoading = true;

// --- MOCK DATA (Fallback) ---
const SAMPLE_ARTICLES = [
    { id: '1', title: 'Wärmepumpen-Boom in Mannheim', summary: 'Die Nachfrage steigt rasant.', content: '<h2>Markt im Wandel</h2><p>Die Zahlen sprechen eine klare Sprache...</p>', author: 'Redaktion', category: 'Branchen-News', status: 'published', publishedAt: new Date().toISOString(), featured: true, imageUrl: 'https://images.unsplash.com/photo-1581092334651-ddf26d9a09d0?auto=format&fit=crop&q=80&w=1200' },
    { id: '2', title: 'Neues Ausbildungszentrum', summary: 'Handwerkskammer investiert.', content: '<p>Mehr Platz für Azubis...</p>', author: 'Redaktion', category: 'Personal & Karriere', status: 'published', publishedAt: new Date().toISOString(), featured: false, imageUrl: 'https://images.unsplash.com/photo-1521791136064-7986c2920216?auto=format&fit=crop&q=80&w=1200' }
];
const SAMPLE_DIRECTORY = [
    { id: 'd1', name: 'Müller Sanitär', category: 'Sanitär', city: 'Mannheim', description: 'Ihr Partner für Bad & WC.', logoUrl: 'https://via.placeholder.com/100', address: 'Hauptstr 1', phone: '0621-12345' }
];

// --- INITIALIZATION ---
async function init() {
    // 1. Load from fallback immediately (so site isn't blank)
    articles = SAMPLE_ARTICLES;
    directory = SAMPLE_DIRECTORY;
    
    // Check URL params for routing
    handleRouting();

    // 2. Fetch Live Data
    try {
        const res = await fetch(API_URL);
        const data = await res.json();
        
        if (data.articles && data.articles.length > 0) articles = data.articles;
        if (data.directory && data.directory.length > 0) directory = data.directory;
        
        // Re-render with live data
        handleRouting();
    } catch (e) {
        console.error("Live fetch failed, using fallback.", e);
    } finally {
        isLoading = false;
        updateUI();
    }
}

function handleRouting() {
    const params = new URLSearchParams(window.location.search);
    const view = params.get('view');
    const id = params.get('id');

    if (view === 'directory') {
        renderDirectory();
    } else if (id) {
        renderArticle(id);
    } else {
        renderMagazine();
    }
}

function router(view, id = null) {
    let url = 'index.html';
    if (view === 'directory') url += '?view=directory';
    if (view === 'article' || view === 'page') url += `?id=${id}`;
    
    window.history.pushState({}, '', url);
    handleRouting();
    window.scrollTo(0,0);
}

window.onpopstate = handleRouting;

// --- RENDER FUNCTIONS ---

function renderMagazine() {
    const app = document.getElementById('app-content');
    const featured = articles.find(a => a.featured) || articles[0];
    const feed = articles.filter(a => a.id !== featured.id);

    app.innerHTML = `
        <!-- Hero Section -->
        <div class="relative w-full h-[500px] bg-brand-dark flex items-center overflow-hidden">
            <img src="${featured.imageUrl}" class="absolute inset-0 w-full h-full object-cover opacity-50" />
            <div class="relative z-10 max-w-7xl mx-auto px-4 w-full text-white">
                <span class="bg-brand-copper text-[10px] font-bold uppercase px-2 py-1 rounded-sm mb-4 inline-block">Top Story</span>
                <h1 class="text-4xl md:text-6xl font-black mb-6 leading-tight max-w-3xl">${featured.title}</h1>
                <p class="text-xl text-gray-200 mb-8 max-w-xl line-clamp-2">${featured.summary}</p>
                <button onclick="router('article', '${featured.id}')" class="bg-white text-brand-dark px-8 py-3 font-bold uppercase text-xs tracking-widest hover:bg-brand-copper hover:text-white transition">Story Lesen</button>
            </div>
        </div>

        <!-- Latest News -->
        <div class="max-w-7xl mx-auto px-4 py-16">
            <h2 class="text-3xl font-bold text-brand-dark mb-12 border-b border-gray-200 pb-4">Aktuelle Nachrichten</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                ${feed.map(article => `
                <div onclick="router('article', '${article.id}')" class="group cursor-pointer bg-white border border-gray-100 shadow-sm hover:shadow-xl transition-all duration-300 rounded-sm overflow-hidden">
                    <div class="h-48 overflow-hidden">
                        <img src="${article.imageUrl}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                    </div>
                    <div class="p-6">
                        <span class="text-[10px] font-bold text-brand-copper uppercase tracking-wider">${article.category}</span>
                        <h3 class="text-xl font-bold text-brand-dark mt-2 mb-3 leading-snug group-hover:text-brand-copper transition">${article.title}</h3>
                        <p class="text-sm text-gray-500 line-clamp-3 mb-4">${article.summary}</p>
                        <div class="flex items-center text-xs text-gray-400 font-bold uppercase tracking-wider">
                            <span>Mehr Lesen</span>
                            <i data-lucide="arrow-right" class="w-3 h-3 ml-1"></i>
                        </div>
                    </div>
                </div>
                `).join('')}
            </div>
        </div>
        
        <!-- Trust Banner -->
        <div class="bg-brand-dark py-12">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h3 class="text-white text-xl font-bold mb-2">Tief verwurzelt in Rhein-Neckar</h3>
                <p class="text-gray-400">Verbindet Unternehmen in Mannheim, Heidelberg, Ludwigshafen und darüber hinaus.</p>
            </div>
        </div>
    `;
    lucide.createIcons();
}

function renderArticle(id) {
    const app = document.getElementById('app-content');
    const article = articles.find(a => a.id === id);

    if (!article) {
        app.innerHTML = `<div class="p-20 text-center"><h1 class="text-2xl font-bold">Artikel nicht gefunden</h1><button onclick="router('home')" class="text-brand-copper underline mt-4">Zurück</button></div>`;
        return;
    }

    app.innerHTML = `
        <article class="max-w-4xl mx-auto px-4 py-16">
            <button onclick="router('home')" class="mb-8 flex items-center text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-brand-copper transition"><i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Zurück</button>
            
            <header class="text-center mb-12">
                <span class="bg-brand-surface text-brand-dark border border-brand-dark px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">${article.category}</span>
                <h1 class="text-4xl md:text-5xl font-black text-brand-dark mt-6 mb-6 leading-tight">${article.title}</h1>
                <div class="flex justify-center items-center space-x-4 text-sm text-gray-500">
                    <span class="font-bold text-brand-copper">${article.author}</span>
                    <span>•</span>
                    <span>${new Date(article.publishedAt).toLocaleDateString()}</span>
                </div>
            </header>

            ${article.imageUrl ? `<div class="w-full aspect-video mb-12 rounded-sm overflow-hidden shadow-lg"><img src="${article.imageUrl}" class="w-full h-full object-cover"/></div>` : ''}

            <div class="prose prose-lg prose-slate max-w-none mx-auto text-gray-800 leading-relaxed">
                ${article.content}
            </div>
        </article>
    `;
    lucide.createIcons();
}

function renderDirectory() {
    const app = document.getElementById('app-content');
    
    app.innerHTML = `
        <div class="bg-brand-surface py-16 border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h1 class="text-4xl font-black text-brand-dark mb-4">Branchenverzeichnis</h1>
                <p class="text-lg text-gray-500 max-w-2xl mx-auto">Finden Sie qualifizierte Fachbetriebe in der Region.</p>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-16">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                ${directory.map(biz => `
                <div class="bg-white p-6 rounded-sm border border-gray-100 hover:shadow-lg transition flex flex-col">
                    <div class="flex items-center mb-4">
                        <img src="${biz.logoUrl}" class="w-12 h-12 object-contain mr-4 border p-1 rounded" onerror="this.src='https://via.placeholder.com/50'"/>
                        <div>
                            <h3 class="font-bold text-lg text-brand-dark leading-tight">${biz.name}</h3>
                            <span class="text-[10px] uppercase font-bold text-gray-400 bg-gray-100 px-2 py-0.5 rounded">${biz.category}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-6 flex-grow">${biz.description}</p>
                    <div class="pt-4 border-t border-gray-50 space-y-2 text-sm text-gray-500">
                        <div class="flex items-center"><i data-lucide="map-pin" class="w-4 h-4 mr-2 text-brand-copper"></i> ${biz.city}</div>
                        <div class="flex items-center"><i data-lucide="phone" class="w-4 h-4 mr-2 text-brand-copper"></i> ${biz.phone}</div>
                    </div>
                </div>
                `).join('')}
            </div>
            ${directory.length === 0 ? '<div class="text-center p-12 text-gray-400">Keine Einträge gefunden.</div>' : ''}
        </div>
    `;
    lucide.createIcons();
}

function updateUI() {
    // Re-run current route logic to refresh data
    handleRouting();
}

// Start
document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>