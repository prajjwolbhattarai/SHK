<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SHK Rhein-Neckar | Branchenmagazin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              display: ['Montserrat', 'sans-serif'],
            },
            colors: {
              'brand-dark': '#0f172a',
              'brand-copper': '#b45309',
              'brand-steel': '#475569',
              'brand-surface': '#f8fafc',
            }
          }
        }
      }
    </script>
    <style>
      .loader { border: 3px solid #f3f3f3; border-top: 3px solid #b45309; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .fade-in { animation: fadeIn 0.5s ease-in; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.10.1"
  }
}
</script>
</head>
<body class="bg-brand-surface text-slate-900 antialiased selection:bg-brand-copper selection:text-white">
    <div id="app"></div>

    <script>
    // --- CONFIGURATION ---
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxw9Sw74S1Yy5W0zVCRHZ7ZxTTOISUKZzk793WkeR8TW9eF61Mws4aGcOPRg1JaiUBuPQ/exec';
    const LOGO_URL = 'components/shklogo.jpg';

    // --- STATE MANAGEMENT ---
    const state = {
        view: 'home', // home, article, directory
        articles: [],
        directory: [],
        categories: ['Branchen-News', 'Betriebs-Features', 'Personal & Karriere', 'Technologie', 'Energie & Nachhaltigkeit', 'Regional'],
        activeCategory: 'All',
        activeArticle: null,
        searchQuery: ''
    };

    // --- MOCK DATA GENERATOR (Fallback) ---
    function generateMockData() {
        const mockArticles = [];
        const cats = state.categories;
        let id = 1;
        
        cats.forEach(cat => {
            for(let i=0; i<4; i++) {
                mockArticles.push({
                    id: `art-${id++}`,
                    title: `${cat}: Neue Entwicklungen im Jahr 2025 - Bericht ${i+1}`,
                    summary: `Ein detaillierter Blick auf die aktuellen Trends im Bereich ${cat}. Was Handwerker jetzt wissen müssen.`,
                    content: `<h2>Einleitung</h2><p>Die Branche bewegt sich schnell. In diesem Artikel beleuchten wir die wichtigsten Aspekte von <strong>${cat}</strong>.</p><h3>Hintergrund</h3><p>Experten sind sich einig, dass Innovation der Schlüssel ist.</p><blockquote>"Wer nicht mit der Zeit geht, geht mit der Zeit."</blockquote><p>Weitere Details folgen in Kürze.</p>`,
                    author: 'Redaktion',
                    category: cat,
                    publishedAt: new Date().toISOString(),
                    imageUrl: `https://source.unsplash.com/random/800x600?${cat.split(' ')[0]},tech`,
                    views: Math.floor(Math.random() * 2000)
                });
            }
        });
        return mockArticles;
    }

    const MOCK_DIRECTORY = [
        { id: 'd1', name: 'Heizung Müller', category: 'Heizung', city: 'Mannheim', address: 'Hauptstr. 1', description: 'Ihr Partner für Wärme.', logoUrl: 'https://via.placeholder.com/100' },
        { id: 'd2', name: 'Sanitär Schmidt', category: 'Sanitär', city: 'Heidelberg', address: 'Bergstr. 10', description: 'Bäderträume werden wahr.', logoUrl: 'https://via.placeholder.com/100' },
        { id: 'd3', name: 'Elektro Fischer', category: 'Elektro', city: 'Ludwigshafen', address: 'Rheinufer 5', description: 'Smart Home Experten.', logoUrl: 'https://via.placeholder.com/100' },
    ];

    // --- INITIALIZATION ---
    async function init() {
        // Load from LocalStorage first for speed
        const savedArticles = localStorage.getItem('shk_articles');
        const savedDirectory = localStorage.getItem('shk_directory');

        if (savedArticles) state.articles = JSON.parse(savedArticles);
        else state.articles = generateMockData();

        if (savedDirectory) state.directory = JSON.parse(savedDirectory);
        else state.directory = MOCK_DIRECTORY;

        // Render immediately
        handleRouting();

        // Fetch fresh data in background
        try {
            const response = await fetch(GOOGLE_SCRIPT_URL);
            if (response.ok) {
                const data = await response.json();
                if (data.articles && data.articles.length > 0) {
                    state.articles = data.articles;
                    localStorage.setItem('shk_articles', JSON.stringify(state.articles));
                }
                if (data.directory && data.directory.length > 0) {
                    state.directory = data.directory;
                    localStorage.setItem('shk_directory', JSON.stringify(state.directory));
                }
                render(); // Re-render with new data
            }
        } catch (e) {
            console.log('Using offline/cached content');
        }
    }

    // --- ROUTING ---
    window.addEventListener('hashchange', handleRouting);

    function handleRouting() {
        const hash = window.location.hash;
        
        if (hash.startsWith('#article/')) {
            const id = hash.split('#article/')[1];
            state.activeArticle = state.articles.find(a => a.id === id);
            state.view = 'article';
        } else if (hash === '#directory') {
            state.view = 'directory';
        } else {
            state.view = 'home';
            state.activeCategory = 'All'; // Reset on home unless specific logic added
        }
        
        // Scroll to top
        window.scrollTo(0, 0);
        render();
    }

    // --- NAVIGATION ACTIONS ---
    function navigateHome() { window.location.hash = ''; }
    function navigateDirectory() { window.location.hash = 'directory'; }
    function navigateArticle(id) { window.location.hash = `article/${id}`; }
    
    function filterCategory(cat) {
        state.activeCategory = cat;
        if (state.view !== 'home') navigateHome();
        else render();
    }

    function handleSearch(e) {
        state.searchQuery = e.target.value;
        render();
    }

    // --- COMPONENT RENDERERS ---

    function renderHeader() {
        const isHome = state.view === 'home';
        const isDir = state.view === 'directory';

        return `
        <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-gray-100 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-20 items-center">
                    <div class="flex-shrink-0 cursor-pointer" onclick="navigateHome()">
                        <img src="${LOGO_URL}" alt="SHK Rhein-Neckar" class="h-12 w-auto object-contain"/>
                    </div>
                    <div class="hidden lg:flex space-x-8 h-full items-center">
                        <button onclick="navigateHome()" class="${isHome && state.activeCategory === 'All' ? 'text-brand-copper border-b-2 border-brand-copper' : 'text-brand-steel'} h-full text-xs font-bold uppercase tracking-widest hover:text-brand-dark transition-colors px-1">Magazin</button>
                        <button onclick="navigateDirectory()" class="${isDir ? 'text-brand-copper border-b-2 border-brand-copper' : 'text-brand-steel'} h-full text-xs font-bold uppercase tracking-widest hover:text-brand-dark transition-colors px-1">Verzeichnis</button>
                        ${state.categories.slice(0, 3).map(cat => `
                            <button onclick="filterCategory('${cat}')" class="${state.activeCategory === cat && isHome ? 'text-brand-copper border-b-2 border-brand-copper' : 'text-brand-steel'} h-full text-xs font-bold uppercase tracking-widest hover:text-brand-dark transition-colors px-1">${cat}</button>
                        `).join('')}
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="admin.html" class="hidden md:block bg-brand-dark text-white px-5 py-2 text-xs font-bold uppercase tracking-wider rounded-sm hover:bg-brand-copper transition">Mitarbeiter Login</a>
                    </div>
                </div>
            </div>
            <!-- Mobile Menu Scroller -->
            <div class="lg:hidden overflow-x-auto whitespace-nowrap px-4 py-2 border-t border-gray-100 bg-gray-50 hide-scrollbar">
                 <button onclick="navigateHome()" class="inline-block px-3 py-1 text-xs font-bold uppercase ${state.view === 'home' && state.activeCategory==='All' ? 'text-brand-copper' : 'text-gray-500'}">Home</button>
                 <button onclick="navigateDirectory()" class="inline-block px-3 py-1 text-xs font-bold uppercase ${state.view === 'directory' ? 'text-brand-copper' : 'text-gray-500'}">Directory</button>
                 ${state.categories.map(cat => `<button onclick="filterCategory('${cat}')" class="inline-block px-3 py-1 text-xs font-bold uppercase ${state.activeCategory === cat && state.view === 'home' ? 'text-brand-copper' : 'text-gray-500'}">${cat}</button>`).join('')}
            </div>
        </nav>`;
    }

    function renderHero() {
        if (state.searchQuery || state.activeCategory !== 'All') return '';
        return `
        <div class="relative bg-brand-dark py-24 px-4 overflow-hidden">
            <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1581092334651-ddf26d9a09d0?auto=format&fit=crop&q=80')] bg-cover bg-center"></div>
            <div class="relative max-w-7xl mx-auto text-center">
                <span class="text-brand-copper font-bold uppercase tracking-[0.3em] text-xs mb-4 block">Das Regionale Branchenmagazin</span>
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-display font-black text-white mb-6 leading-tight">SHK Rhein-Neckar</h1>
                <p class="text-xl text-gray-300 max-w-2xl mx-auto font-light mb-10">Nachrichten, Innovationen und Betriebs-Features für Fachhandwerker in Mannheim, Heidelberg und der Pfalz.</p>
            </div>
        </div>`;
    }

    function renderArticleGrid() {
        // Filter Logic
        let displayArticles = state.articles;
        if (state.searchQuery) {
            const q = state.searchQuery.toLowerCase();
            displayArticles = displayArticles.filter(a => a.title.toLowerCase().includes(q) || a.summary.toLowerCase().includes(q));
        } else if (state.activeCategory !== 'All') {
            displayArticles = displayArticles.filter(a => a.category === state.activeCategory);
        }

        if (displayArticles.length === 0) return `<div class="text-center py-20 text-gray-500">Keine Artikel gefunden.</div>`;

        return `
        <div class="max-w-7xl mx-auto px-4 py-16">
            <div class="flex justify-between items-end mb-10 border-b border-gray-200 pb-4">
                <h2 class="text-3xl font-display font-bold text-brand-dark">${state.activeCategory === 'All' ? 'Neueste Beiträge' : state.activeCategory}</h2>
                
                <div class="relative">
                    <input type="text" placeholder="Suche..." oninput="handleSearch(event)" class="pl-8 pr-4 py-1 border border-gray-300 rounded-sm text-sm focus:border-brand-copper outline-none" value="${state.searchQuery}">
                    <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-2 top-2"></i>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                ${displayArticles.map(article => `
                    <div onclick="navigateArticle('${article.id}')" class="bg-white rounded-sm shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden border border-gray-100 flex flex-col h-full group">
                        <div class="h-48 overflow-hidden relative">
                            <img src="${article.imageUrl || 'https://via.placeholder.com/400x300'}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" alt="${article.title}">
                            <span class="absolute top-4 left-4 bg-white/90 backdrop-blur-sm px-2 py-1 text-[10px] font-bold uppercase tracking-wider text-brand-dark">${article.category}</span>
                        </div>
                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex items-center text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-3">
                                <span class="text-brand-copper">${article.author}</span>
                                <span class="mx-2">•</span>
                                <span>${new Date(article.publishedAt).toLocaleDateString()}</span>
                            </div>
                            <h3 class="text-xl font-display font-bold text-brand-dark mb-3 leading-tight group-hover:text-brand-copper transition-colors">${article.title}</h3>
                            <p class="text-brand-steel text-sm line-clamp-3 mb-4 flex-grow">${article.summary}</p>
                            <div class="flex items-center text-xs font-bold uppercase tracking-widest text-brand-dark mt-auto pt-4 border-t border-gray-50">
                                Lesen <i data-lucide="arrow-right" class="w-3 h-3 ml-1"></i>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
    }

    function renderArticleReader() {
        const article = state.activeArticle;
        if (!article) return `<div class="text-center py-20">Artikel nicht gefunden. <button onclick="navigateHome()" class="underline text-brand-copper">Zurück</button></div>`;

        return `
        <div class="bg-white min-h-screen">
            <div class="max-w-4xl mx-auto px-4 py-16">
                <button onclick="navigateHome()" class="mb-8 flex items-center text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-brand-copper transition">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Zurück zum Magazin
                </button>
                <span class="text-brand-copper font-bold uppercase tracking-widest text-xs mb-4 block">${article.category}</span>
                <h1 class="text-4xl md:text-5xl font-display font-black text-brand-dark mb-8 leading-tight">${article.title}</h1>
                
                ${article.imageUrl ? `
                <div class="w-full aspect-video overflow-hidden rounded-sm mb-10 shadow-lg">
                    <img src="${article.imageUrl}" class="w-full h-full object-cover">
                </div>` : ''}

                <div class="flex items-center justify-between border-y border-gray-100 py-4 mb-10 text-sm text-gray-500">
                    <div class="flex items-center"><i data-lucide="user" class="w-4 h-4 mr-2"></i> ${article.author}</div>
                    <div class="flex items-center"><i data-lucide="calendar" class="w-4 h-4 mr-2"></i> ${new Date(article.publishedAt).toLocaleDateString()}</div>
                </div>

                <div class="prose prose-lg max-w-none prose-headings:font-display prose-headings:font-bold prose-headings:text-brand-dark prose-a:text-brand-copper">
                    ${article.content}
                </div>
            </div>
        </div>`;
    }

    function renderDirectory() {
        return `
        <div class="max-w-7xl mx-auto px-4 py-16">
            <h2 class="text-4xl font-display font-bold text-brand-dark mb-4 text-center">Branchenverzeichnis</h2>
            <p class="text-center text-brand-steel mb-12 max-w-2xl mx-auto">Finden Sie qualifizierte Fachbetriebe in der Rhein-Neckar Region.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                ${state.directory.map(biz => `
                    <div class="bg-white p-6 rounded-sm border border-gray-200 hover:shadow-lg transition flex items-start space-x-4">
                         <img src="${biz.logoUrl || 'https://via.placeholder.com/64'}" class="w-16 h-16 object-contain border border-gray-100 p-1">
                         <div>
                            <span class="text-[10px] font-bold uppercase tracking-wider text-brand-copper bg-orange-50 px-2 py-1 rounded-sm mb-2 inline-block">${biz.category}</span>
                            <h3 class="font-bold text-brand-dark text-lg">${biz.name}</h3>
                            <p class="text-sm text-gray-500 mb-2">${biz.address}, ${biz.city}</p>
                            <a href="${biz.website}" target="_blank" class="text-xs font-bold uppercase text-brand-steel hover:text-brand-copper">Webseite besuchen</a>
                         </div>
                    </div>
                `).join('')}
            </div>
            ${state.directory.length === 0 ? '<div class="text-center text-gray-500">Keine Einträge.</div>' : ''}
        </div>
        `;
    }

    function renderFooter() {
        return `
        <footer class="bg-brand-dark text-white py-12 mt-auto">
            <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                     <img src="${LOGO_URL}" class="h-10 bg-white p-1 rounded-sm mb-2 opacity-90">
                     <p class="text-xs text-gray-400">© 2025 SHK Rhein-Neckar</p>
                </div>
                <div class="flex space-x-6 text-xs font-bold uppercase tracking-widest text-gray-400">
                    <a href="#" class="hover:text-white">Impressum</a>
                    <a href="#" class="hover:text-white">Datenschutz</a>
                    <a href="admin.html" class="hover:text-brand-copper">Login</a>
                </div>
            </div>
        </footer>`;
    }

    // --- MAIN RENDER LOOP ---
    function render() {
        const app = document.getElementById('app');
        let content = '';

        content += renderHeader();

        if (state.view === 'home') {
            content += renderHero();
            content += renderArticleGrid();
        } else if (state.view === 'article') {
            content += renderArticleReader();
        } else if (state.view === 'directory') {
            content += renderDirectory();
        }

        content += renderFooter();
        app.innerHTML = content;
        
        // Initialize Icons
        if (window.lucide) lucide.createIcons();
    }

    // Start App
    init();

    </script>
</body>
</html>