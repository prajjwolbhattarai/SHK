<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMS | SHK Rhein-Neckar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Montserrat', 'sans-serif'] },
            colors: { 'brand-dark': '#0f172a', 'brand-copper': '#b45309', 'brand-steel': '#475569', 'brand-surface': '#f8fafc' }
          }
        }
      }
    </script>
</head>
<body class="bg-gray-100 font-sans">
    <div id="app-root">
        <!-- App is rendered by JavaScript -->
    </div>

<script>
// V A N I L L A   J S   C M S

// --- 1. DATA STORE (Loaded from localStorage or mock) ---
let articles = [];
let directory = [];
let categories = [];
const MOCK_ARTICLES_DATA = [{ id: 'art-1', type: 'article', title: 'Neue Energieverordnungen 2025', summary: 'Ein umfassender Bericht.', content: '<p>Details hier...</p>', imageUrl: 'https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&q=80&w=1200', category: 'Branchen-News', author: 'Redaktion', publishedAt: new Date().toISOString(), featured: true, views: 1234, shares: 56, readTime: 180 }];
const MOCK_DIRECTORY_DATA = [{ id: 'dir-1', name: 'Heizungstechnik Müller GmbH', category: 'Heizung', address: 'Hauptstraße 10', city: 'Mannheim', zip: '68159', phone: '0621 123456', website: 'https://heizung-mueller.de', description: 'Spezialist für moderne Heizsysteme.', logoUrl: 'https://logo.clearbit.com/heizung-mueller.de' }];
const MOCK_CATEGORIES_DATA = ['Branchen-News', 'Betriebs-Features', 'Technologie'];

function loadData() {
    articles = JSON.parse(localStorage.getItem('shk_articles')) || MOCK_ARTICLES_DATA;
    directory = JSON.parse(localStorage.getItem('shk_directory')) || MOCK_DIRECTORY_DATA;
    categories = JSON.parse(localStorage.getItem('shk_categories')) || MOCK_CATEGORIES_DATA;
}
function saveData() {
    localStorage.setItem('shk_articles', JSON.stringify(articles));
    localStorage.setItem('shk_directory', JSON.stringify(directory));
    localStorage.setItem('shk_categories', JSON.stringify(categories));
    alert('Local data saved!');
}

// --- 2. STATE MANAGEMENT ---
const appState = {
    isAuthenticated: false,
    activeView: 'dashboard',
    isEditing: false,
    currentItem: null,
};

// --- 3. RENDER FUNCTIONS ---
function render() {
    const root = document.getElementById('app-root');
    appState.isAuthenticated = sessionStorage.getItem('shk_auth') === 'true';

    if (!appState.isAuthenticated) {
        root.innerHTML = renderLogin();
        attachLoginListeners();
    } else if (appState.isEditing) {
        root.innerHTML = renderEditor();
        attachEditorListeners();
    } else {
        root.innerHTML = renderCMS();
        attachCMSListeners();
    }
}

function renderLogin() {
    return `
    <div class="min-h-screen bg-brand-dark flex flex-col justify-center items-center p-4">
      <div class="bg-white w-full max-w-sm rounded-sm shadow-2xl overflow-hidden z-10">
        <div class="p-8">
          <div class="text-center mb-8">
             <img src="shklogo.jpg" alt="SHK Rhein-Neckar" class="h-20 w-auto mx-auto mb-4"/>
             <p class="text-brand-steel text-xs uppercase tracking-widest mt-1">Internal CMS</p>
          </div>
          <form id="login-form" class="space-y-5">
            <div>
              <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Password</label>
              <input type="password" id="password" required class="w-full border border-gray-300 rounded-sm p-3 text-sm focus:border-brand-copper outline-none transition" placeholder="••••••••"/>
            </div>
            <button type="submit" class="w-full bg-brand-dark text-white py-3 rounded-sm font-bold uppercase text-xs tracking-wider hover:bg-brand-copper transition">Sign In</button>
          </form>
        </div>
      </div>
      <a href="index.html" class="mt-8 text-white/40 text-xs font-bold uppercase tracking-widest hover:text-white transition cursor-pointer z-10">← Back to Magazine</a>
    </div>`;
}

function renderCMS() {
    const newsArticles = articles.filter(a => a.type === 'article' || !a.type);
    return `
    <div class="min-h-screen bg-gray-100 font-sans flex">
      <aside class="w-64 bg-brand-dark text-gray-400 flex flex-col fixed h-full z-10">
        <div class="p-6">
           <div class="flex items-center space-x-2 text-white mb-8"><img src="shklogo.jpg" alt="SHK CMS" class="h-10 w-auto rounded-sm bg-white p-1"/><span class="text-xs uppercase tracking-wider font-medium opacity-50">CMS</span></div>
           <nav class="space-y-2">
             <button data-view="dashboard" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-sm text-sm font-bold uppercase tracking-wider transition ${appState.activeView === 'dashboard' ? 'bg-brand-copper text-white' : 'hover:bg-white/5 hover:text-white'}"><span>Dashboard</span></button>
             <button data-view="articles" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-sm text-sm font-bold uppercase tracking-wider transition ${appState.activeView === 'articles' ? 'bg-brand-copper text-white' : 'hover:bg-white/5 hover:text-white'}"><span>Articles</span></button>
             <button data-view="directory" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 rounded-sm text-sm font-bold uppercase tracking-wider transition ${appState.activeView === 'directory' ? 'bg-brand-copper text-white' : 'hover:bg-white/5 hover:text-white'}"><span>Directory</span></button>
           </nav>
        </div>
        <div class="mt-auto p-6 border-t border-gray-800"><button id="logout-btn" class="flex items-center space-x-2 text-sm font-medium hover:text-white transition"><span>Logout</span></button></div>
      </aside>
      <main class="ml-64 flex-grow p-8">
        <h1 class="text-3xl font-display font-bold text-gray-900 capitalize mb-10">${appState.activeView}</h1>
        <div id="view-content">
            ${appState.activeView === 'dashboard' ? `<div>Dashboard content here. Local changes are saved to browser storage. Use a real database for production. <button id="save-data-btn" class="bg-blue-500 text-white p-2">Save to Local Storage</button></div>` : ''}
            ${appState.activeView === 'articles' ? `
                <div class="flex justify-end mb-6"><button id="create-article-btn" class="create-btn flex items-center bg-brand-copper text-white px-5 py-2.5 rounded-sm font-bold uppercase text-xs">New Article</button></div>
                <div class="bg-white rounded-sm shadow-sm border"><table class="w-full text-left"><thead><tr><th class="p-4">Title</th><th class="p-4">Category</th><th class="p-4">Actions</th></tr></thead>
                <tbody>${newsArticles.map(a => `<tr><td class="p-4">${a.title}</td><td>${a.category}</td><td><button data-id="${a.id}" class="edit-article-btn p-2">Edit</button><button data-id="${a.id}" class="delete-article-btn p-2">Delete</button></td></tr>`).join('')}</tbody></table></div>
            ` : ''}
            ${appState.activeView === 'directory' ? `
                <div class="flex justify-end mb-6"><button id="create-business-btn" class="create-btn flex items-center bg-brand-copper text-white px-5 py-2.5 rounded-sm font-bold uppercase text-xs">New Entry</button></div>
                <div class="bg-white rounded-sm shadow-sm border"><table class="w-full text-left"><thead><tr><th class="p-4">Name</th><th class="p-4">City</th><th class="p-4">Actions</th></tr></thead>
                <tbody>${directory.map(b => `<tr><td class="p-4">${b.name}</td><td>${b.city}</td><td><button data-id="${b.id}" class="edit-business-btn p-2">Edit</button><button data-id="${b.id}" class="delete-business-btn p-2">Delete</button></td></tr>`).join('')}</tbody></table></div>
            ` : ''}
        </div>
      </main>
    </div>`;
}

function renderEditor() {
    const item = appState.currentItem;
    const isArticle = !!item.content; // Differentiate article from business
    return `
    <div class="min-h-screen bg-gray-50 pb-20 font-sans">
      <div class="sticky top-0 z-40 bg-white border-b px-6 py-4 flex justify-between items-center shadow-sm">
        <h2 class="text-lg font-bold text-gray-800">${item.id ? 'Edit' : 'Create'} ${isArticle ? 'Article' : 'Business'}</h2>
        <div class="flex space-x-3">
          <button id="cancel-edit-btn" class="text-gray-500 p-2">Cancel</button>
          <button id="save-item-btn" class="bg-green-600 text-white px-6 py-2 rounded-sm font-bold uppercase text-xs">Save</button>
        </div>
      </div>
      <div class="max-w-4xl mx-auto p-6 space-y-4">
        ${isArticle ? `
          <div><label class="text-xs font-bold">Title</label><input id="edit-title" value="${item.title || ''}" class="w-full border p-2 mt-1" /></div>
          <div><label class="text-xs font-bold">Summary</label><textarea id="edit-summary" class="w-full border p-2 mt-1">${item.summary || ''}</textarea></div>
          <div><label class="text-xs font-bold">Content</label><div id="editor" class="w-full border p-2 mt-1 bg-white" contenteditable>${item.content || ''}</div></div>
        ` : `
          <div><label class="text-xs font-bold">Name</label><input id="edit-name" value="${item.name || ''}" class="w-full border p-2 mt-1" /></div>
          <div><label class="text-xs font-bold">City</label><input id="edit-city" value="${item.city || ''}" class="w-full border p-2 mt-1" /></div>
          <div><label class="text-xs font-bold">Description</label><textarea id="edit-description" class="w-full border p-2 mt-1">${item.description || ''}</textarea></div>
        `}
      </div>
    </div>`;
}


// --- 4. EVENT LISTENERS ---
function attachLoginListeners() {
    document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        // Simple password check for demo
        if (document.getElementById('password').value) {
            sessionStorage.setItem('shk_auth', 'true');
            appState.isAuthenticated = true;
            render();
        } else {
            alert('Password required.');
        }
    });
}

function attachCMSListeners() {
    document.getElementById('logout-btn').addEventListener('click', () => {
        sessionStorage.removeItem('shk_auth');
        appState.isAuthenticated = false;
        render();
    });

    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            appState.activeView = e.currentTarget.getAttribute('data-view');
            render();
        });
    });

    // CRUD buttons
    document.getElementById('create-article-btn')?.addEventListener('click', () => handleCreate('article'));
    document.getElementById('create-business-btn')?.addEventListener('click', () => handleCreate('business'));
    
    document.querySelectorAll('.edit-article-btn').forEach(b => b.addEventListener('click', (e) => handleEdit('article', e.currentTarget.dataset.id)));
    document.querySelectorAll('.delete-article-btn').forEach(b => b.addEventListener('click', (e) => handleDelete('article', e.currentTarget.dataset.id)));
    
    document.querySelectorAll('.edit-business-btn').forEach(b => b.addEventListener('click', (e) => handleEdit('business', e.currentTarget.dataset.id)));
    document.querySelectorAll('.delete-business-btn').forEach(b => b.addEventListener('click', (e) => handleDelete('business', e.currentTarget.dataset.id)));

    document.getElementById('save-data-btn')?.addEventListener('click', saveData);
}

function attachEditorListeners() {
    document.getElementById('cancel-edit-btn').addEventListener('click', () => {
        appState.isEditing = false;
        appState.currentItem = null;
        render();
    });
    document.getElementById('save-item-btn').addEventListener('click', handleSave);
}

// --- 5. CRUD LOGIC ---
function handleCreate(type) {
    appState.isEditing = true;
    if (type === 'article') {
        appState.currentItem = { type: 'article', title: '', summary: '', content: '' };
    } else {
        appState.currentItem = { name: '', city: '', description: '' };
    }
    render();
}
function handleEdit(type, id) {
    appState.isEditing = true;
    if (type === 'article') {
        appState.currentItem = { ...articles.find(a => a.id === id) };
    } else {
        appState.currentItem = { ...directory.find(b => b.id === id) };
    }
    render();
}
function handleDelete(type, id) {
    if (!confirm('Are you sure?')) return;
    if (type === 'article') {
        articles = articles.filter(a => a.id !== id);
    } else {
        directory = directory.filter(b => b.id !== id);
    }
    saveData();
    render();
}
function handleSave() {
    const item = appState.currentItem;
    const isArticle = !!item.content || item.type === 'article';

    if (isArticle) {
        const updatedArticle = {
            ...item,
            id: item.id || `art-${Date.now()}`,
            title: document.getElementById('edit-title').value,
            summary: document.getElementById('edit-summary').value,
            content: document.getElementById('editor').innerHTML,
        };
        const index = articles.findIndex(a => a.id === updatedArticle.id);
        if (index > -1) articles[index] = updatedArticle;
        else articles.unshift(updatedArticle);
    } else {
         const updatedBusiness = {
            ...item,
            id: item.id || `dir-${Date.now()}`,
            name: document.getElementById('edit-name').value,
            city: document.getElementById('edit-city').value,
            description: document.getElementById('edit-description').value,
        };
        const index = directory.findIndex(b => b.id === updatedBusiness.id);
        if (index > -1) directory[index] = updatedBusiness;
        else directory.unshift(updatedBusiness);
    }
    
    appState.isEditing = false;
    appState.currentItem = null;
    saveData();
    render();
}

// --- 6. INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    render();
});
</script>
</body>
</html>
