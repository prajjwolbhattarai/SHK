<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMS | SHK Rhein-Neckar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Montserrat', 'sans-serif'] },
            colors: { 'brand-dark': '#0f172a', 'brand-copper': '#b45309', 'brand-steel': '#475569', 'brand-surface': '#f8fafc' }
          }
        }
      }
    </script>
</head>
<body class="bg-gray-100 font-sans text-brand-dark">
    <div id="app-root"></div>

<script>
// --- V A N I L L A   J S   C M S ---

const DEFAULT_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxw9Sw74S1Yy5W0zVCRHZ7ZxTTOISUKZzk793WkeR8TW9eF61Mws4aGcOPRg1JaiUBuPQ/exec';

// 10 Sample Articles Data for Initialization
const SAMPLE_DATA_ARTICLES = [
  {id:'art-1',type:'article',title:'Wärmeplanung Mannheim: Was Handwerker jetzt wissen müssen',summary:'Die Stadt Mannheim hat ihren kommunalen Wärmeplan vorgelegt. Für SHK-Betriebe ergeben sich daraus konkrete Handlungsfelder.',content:'<h2>Der Fahrplan steht</h2><p>Bis 2045 soll Mannheim klimaneutral sein...</p>',category:'Regional',imageUrl:'https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&q=80&w=1200',author:'Redaktion',publishedAt:new Date().toISOString(),featured:true,views:1240,shares:45,readTime:240},
  {id:'art-2',type:'article',title:'Fachkräftemangel: Azubi-Recruiting über TikTok',summary:'Ein Heidelberger SHK-Betrieb geht neue Wege in der Nachwuchsgewinnung.',content:'<h2>Dahin gehen, wo die Jugend ist</h2><p>Statt Stellenanzeigen in der Zeitung setzt die Firma...</p>',category:'Personal & Karriere',imageUrl:'https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&q=80&w=1200',author:'Sarah Weber',publishedAt:new Date().toISOString(),featured:false,views:890,shares:120,readTime:180},
  {id:'art-3',type:'article',title:'Förderstopp für E-Mobilität: Folgen für den Fuhrpark',summary:'Lohnt sich der Umstieg auf E-Transporter noch?',content:'<h2>Kalkulation neu gedacht</h2><p>Ohne die staatliche Förderung müssen SHK-Betriebe rechnen...</p>',category:'Betriebs-Features',imageUrl:'https://images.unsplash.com/photo-1593941707882-a5bba14938c7?auto=format&fit=crop&q=80&w=1200',author:'Finanz-Experte',publishedAt:new Date().toISOString(),featured:false,views:650,shares:12,readTime:300},
  {id:'art-4',type:'article',title:'ISH Nachlese: Das barrierefreie Bad wird digital',summary:'Smarte Armaturen und höhenverstellbare WCs waren die Trends.',content:'<h2>Technik trifft Komfort</h2><p>Das Badezimmer von morgen denkt mit...</p>',category:'Technologie',imageUrl:'https://images.unsplash.com/photo-1584622050111-993a426fbf0a?auto=format&fit=crop&q=80&w=1200',author:'Redaktion',publishedAt:new Date().toISOString(),featured:false,views:1100,shares:67,readTime:420},
  {id:'art-5',type:'article',title:'Trinkwasserhygiene: Neue DIN-Normen ab 2025',summary:'Vermieter und Verwalter müssen handeln.',content:'<h2>Legionellen-Prävention verschärft</h2><p>Die Temperaturgrenzen wurden angepasst...</p>',category:'Branchen-News',imageUrl:'https://images.unsplash.com/photo-1532601224476-15c79f2f7a51?auto=format&fit=crop&q=80&w=1200',author:'Dr. Wasser',publishedAt:new Date().toISOString(),featured:false,views:430,shares:8,readTime:360},
  {id:'art-6',type:'article',title:'Materialpreise stabilisieren sich',summary:'Kupfer, Stahl und Keramik bleiben teuer, aber stabil.',content:'<h2>Planungssicherheit kehrt zurück</h2><p>Der Großhandel meldet entspannte Lieferketten...</p>',category:'Branchen-News',imageUrl:'https://images.unsplash.com/photo-1581094794329-cd136ce4dad9?auto=format&fit=crop&q=80&w=1200',author:'Analyst',publishedAt:new Date().toISOString(),featured:false,views:980,shares:33,readTime:200},
  {id:'art-7',type:'article',title:'Großprojekt: Uniklinik Lüftung',summary:'Austausch von 5 Großgeräten im laufenden OP-Betrieb.',content:'<h2>Präzision am offenen Herzen</h2><p>Die Firma AirTech hat das Unmögliche möglich gemacht...</p>',category:'Regional',imageUrl:'https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&q=80&w=1200',author:'Redaktion',publishedAt:new Date().toISOString(),featured:false,views:1500,shares:89,readTime:600},
  {id:'art-8',type:'article',title:'Wasserstoff-Ready: Marketing oder Zukunft?',summary:'Wann kommt der grüne Wasserstoff wirklich?',content:'<h2>Warten auf das Netz</h2><p>Technisch sind die Geräte bereit...</p>',category:'Energie & Nachhaltigkeit',imageUrl:'https://images.unsplash.com/photo-1532996126620-e918996f6428?auto=format&fit=crop&q=80&w=1200',author:'Ing. Peters',publishedAt:new Date().toISOString(),featured:false,views:2100,shares:150,readTime:480},
  {id:'art-9',type:'article',title:'Digitale Bauakte kommt',summary:'Behörden stellen auf papierlose Anträge um.',content:'<h2>Papierlos zum Bauantrag</h2><p>Ab 2025 sollen Bauanträge nur noch digital eingereicht werden...</p>',category:'Betriebs-Features',imageUrl:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&q=80&w=1200',author:'Recht',publishedAt:new Date().toISOString(),featured:false,views:320,shares:5,readTime:240},
  {id:'art-10',type:'article',title:'Nachfolge im Handwerk',summary:'Familienbetrieb Müller in 3. Generation übergeben.',content:'<h2>Tradition trifft Moderne</h2><p>Seniorchef Hans Müller übergibt an Tochter Lisa...</p>',category:'Personal & Karriere',imageUrl:'https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&q=80&w=1200',author:'Lisa Müller',publishedAt:new Date().toISOString(),featured:false,views:1800,shares:200,readTime:500}
];

let articles = [];
let directory = [];
let categories = [];
let settings = { articlesScriptUrl: DEFAULT_SCRIPT_URL, userRole: 'Administrator' };

const appState = { isAuthenticated: false, activeView: 'dashboard', modalOpen: false, modalType: null, editingItem: null, syncState: 'idle' };

function loadData() {
    articles = JSON.parse(localStorage.getItem('shk_articles')) || [];
    directory = JSON.parse(localStorage.getItem('shk_directory')) || [];
    categories = JSON.parse(localStorage.getItem('shk_categories')) || ['Branchen-News', 'Betriebs-Features', 'Personal & Karriere', 'Technologie', 'Energie & Nachhaltigkeit', 'Regional'];
    settings = JSON.parse(localStorage.getItem('shk_settings')) || settings;
    // Do not auto-seed here to respect empty state, let user decide via button
}

function saveData() {
    localStorage.setItem('shk_articles', JSON.stringify(articles));
    localStorage.setItem('shk_directory', JSON.stringify(directory));
    localStorage.setItem('shk_categories', JSON.stringify(categories));
    localStorage.setItem('shk_settings', JSON.stringify(settings));
}

function loadDemoData() {
    if(confirm('This will overwrite current articles with the demo set. Continue?')) {
        articles = [...SAMPLE_DATA_ARTICLES];
        saveData();
        render();
        alert('Demo articles loaded! You can now Sync to push them to Google.');
    }
}

function render() {
    const root = document.getElementById('app-root');
    appState.isAuthenticated = sessionStorage.getItem('shk_auth') === 'true';
    if (!appState.isAuthenticated) {
        root.innerHTML = `<div class="min-h-screen bg-brand-dark flex flex-col justify-center items-center p-4"><div class="bg-white w-full max-w-sm rounded-sm shadow-2xl p-8"><div class="text-center mb-8"><img src="components/shklogo.jpg" alt="Logo" class="h-16 mx-auto mb-2"/><p class="text-xs font-bold text-gray-400 uppercase tracking-widest">CMS Login</p></div><form id="login-form" class="space-y-4"><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Password</label><input type="password" id="password" class="w-full border border-gray-300 p-3 rounded-sm text-sm focus:border-brand-copper outline-none" required></div><button type="submit" class="w-full bg-brand-dark text-white py-3 rounded-sm font-bold uppercase text-xs tracking-wider hover:bg-brand-copper transition">Sign In</button></form></div></div>`;
        document.getElementById('login-form').addEventListener('submit', (e) => { e.preventDefault(); sessionStorage.setItem('shk_auth', 'true'); render(); });
    } else {
        root.innerHTML = `<div class="flex h-screen overflow-hidden"><aside class="w-64 bg-brand-dark flex flex-col"><div class="h-20 flex items-center justify-center border-b border-gray-800"><img src="components/shklogo.jpg" class="h-8 bg-white p-1 rounded-sm"/></div><div class="flex-grow py-4 space-y-1">${['dashboard','articles','directory','settings'].map(v=>`<button onclick="appState.activeView='${v}';render()" class="w-full text-left px-6 py-3 text-sm font-bold uppercase text-gray-400 hover:text-white hover:bg-white/5 ${appState.activeView===v?'bg-brand-copper text-white':''}">${v}</button>`).join('')}</div></aside><main class="flex-1 p-8 overflow-auto">${renderMainContent()}</main></div>`;
        lucide.createIcons();
    }
}

function renderMainContent() {
    if(appState.activeView === 'settings') {
        return `<div class="bg-white p-8 rounded-sm shadow-sm max-w-2xl"><h2 class="text-xl font-bold mb-6">Settings</h2><label class="block text-xs font-bold mb-2">Google Apps Script URL</label><input id="script-url" value="${settings.articlesScriptUrl}" class="w-full border p-2 mb-4 rounded-sm text-sm"><button onclick="saveSettings()" class="bg-brand-dark text-white px-6 py-2 text-xs font-bold uppercase rounded-sm">Save</button><hr class="my-8"><div class="space-y-4"><h3 class="font-bold">Data Management</h3><button onclick="triggerSync()" class="w-full border border-gray-300 px-6 py-3 text-xs font-bold uppercase rounded-sm hover:bg-gray-50 flex items-center justify-center mb-2">${appState.syncState==='loading'?'Syncing...':'Sync with Google'}</button><button onclick="loadDemoData()" class="w-full border border-brand-copper text-brand-copper px-6 py-3 text-xs font-bold uppercase rounded-sm hover:bg-orange-50 flex items-center justify-center">Reset to Demo Data</button></div></div>`;
    }
    if(appState.activeView === 'articles') return renderArticlesList();
    return `<div class="bg-white p-8"><h2 class="text-2xl font-bold mb-4">Dashboard</h2><p>Welcome to SHK CMS.</p></div>`;
}

function renderArticlesList() {
    return `<div class="flex justify-between mb-6"><h2 class="text-xl font-bold">Articles</h2><span class="text-xs text-gray-500">${articles.length} items</span></div><div class="bg-white shadow-sm border border-gray-200"><table class="w-full text-left"><thead class="bg-gray-50 text-xs uppercase font-bold text-gray-500"><tr><th class="p-4">Title</th><th class="p-4">Category</th></tr></thead><tbody>${articles.map(a=>`<tr><td class="p-4 font-medium">${a.title}</td><td class="p-4">${a.category}</td></tr>`).join('')}</tbody></table></div>`;
}

function saveSettings() {
    settings.articlesScriptUrl = document.getElementById('script-url').value;
    saveData();
    alert('Saved');
}

async function triggerSync() {
    appState.syncState = 'loading'; render();
    try {
        await fetch(settings.articlesScriptUrl, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action:'sync', articles, directory}) });
        setTimeout(() => { appState.syncState = 'idle'; alert('Sync command sent! Check site in 30s.'); render(); }, 2000);
    } catch(e) { console.error(e); appState.syncState = 'idle'; render(); }
}

document.addEventListener('DOMContentLoaded', () => { loadData(); render(); });
</script>
</body>
</html>